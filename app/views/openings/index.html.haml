- title("Schedule an Apppointment")
- javascript('service_providers', 'openings', 'time_range_slider')
- stylesheet('appointments', 'calendar')

-# service providers mapping services to providers
.span-16.service_providers.hide
  - @sps.each do |sp|
    .service_provider{:service_id => sp[0], :provider_id => sp[1], :provider_name => sp[2], :provider_type => sp[3]}

.span-16.services.hide
  - @sps.each do |sp|
    .service{:service_id => sp[0], :allow_custom_duration => sp[4], :service_duration => Duration.to_words(sp[5], :prepend => "Typically")}
          
- unless @daterange.blank?
  .span-15.prepend-1.append-1
    .span-15.last.padding-top-10
      -# show count of available timeslots for the service and provider
      %h3
        = highlight("#{@service.name} with #{@provider.name}", [@service.name, @provider.name], :highlighter => '<strong class="shaded">\1</strong>')
      %h4{:style => 'color: #666666; line-height: 1.5em;'}
        - if @free_capacity_slots.blank?
          == We found no available timeslots matching your search criteria.
        - else
          == We found #{pluralize(@free_capacity_slots.size, 'available timeslot')} matching your search criteria.
          = highlight("Pick a #{Duration.to_words(@duration).singularize} window below or", Duration.to_words(@duration).singularize, :highlighter => '<strong class="shaded">\1</strong>')
          %br
          = link_to "Notify me if there is an opening", @waitlist_path, :class => 'notify waitlist'
          == if you can't find a suitable timeslot.
          
    .span-14.last
      -# show daterange name
      %h3.calendar.date_range_name= @daterange.name(:with_dates => true)

    - cache(@openings_cache_key, :expires_in => 5.minutes) do
      .span-15.last#free_calendar
        = render(:partial => 'shared/calendar', :locals => {:total_days => @daterange.days, :start_day => @daterange.start_at, :today => DateRange.today, :markings => @calendar_markings})
      .span-14.last.appointments#free_capacity_slots
        = render(:partial => 'appointments/free_capacity_slots', :locals => {:capacity_slots_by_day => @free_capacity_slots_by_day, :service => @service})

    .span-15.last
      -# show waitlist text here if there are no available timeslots
      - if @free_capacity_slots.blank?
        %h2
          = link_to "Notify me if there is an opening", @waitlist_path, :class => 'notify waitlist'
          %span{:style => 'font-size: 0.7em;'}== or
        %h3{:style => 'font-size: 1.3em; color: #666666;'}== Use the search bar to the right to change your search parameters and try again.
    
.last{:class => @daterange ? "span-7" : "span-24"}
  .span-7.mat
    = render(:partial => 'openings/search', :locals => {:title => @daterange ? "Modify Your Search" : "Make an Appointment", :submit_text => @daterange ? "Search Again" : "Search", :providers => @providers, :provider => @provider, :services => @services, :service => @service, :duration => @duration, :when_range => @when, :time => @time, :size => @daterange ? :narrow : :wide})
  - if @daterange.blank? && !current_company.description.blank?
    .span-15.prepend-1.last.company_description
      = Sanitize.clean(current_company.description, Sanitize::Config::WALNUT)
  - else
    .last

  -#.span-7.last.sidebar.instructions
    -#= render(:partial => "openings/search_instructions", :locals => {:when_range => @when, :free_appointments => @free_appointments})
