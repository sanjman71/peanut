- stuff_by_day.each do |day, stuff|
  .span-15.last.calendar_schedule_date{:id => "date_#{day.to_s(:appt_schedule_day)}"}
    .span-11.last.calendar.date.wide= day.to_s(:appt_day)
    - reset_cycle
    -# sort all day's stuff by start at time; where an appointment and a capacity slot are at the same time, the capacity slot always comes first
    - stuff.sort_by{ |o| [o.start_at.in_time_zone, (o.class == CapacitySlot2 ? 0 : 1)] }.each do |object|
      -# check what type of stuff it is, possible options:
      -# appointments, capacity_slots, [waitlist, date, waitlist_time_range]
      - case
      - when object.is_a?(Appointment)
        = render(:partial => 'appointments/free_work_appointments', :locals => {:day => day, :appointment => object})
      - when object.is_a?(CapacitySlot)
        = render(:partial => 'appointments/capacity_slot', :locals => {:day => day, :slot => object})
      - when object.is_a?(CapacitySlot2)
        = render(:partial => 'appointments/capacity_slot2', :locals => {:day => day, :slot => object})
      - when object.is_a?(Array)
        = render(:partial => 'waitlists/waitlist', :locals => {:day => day, :waitlist => object[0], :waitlist_time_range => object[2]})
