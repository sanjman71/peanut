- title("Schedules")
- javascript('date', 'jquery.bgiframe', 'jquery.datePicker', 'appointments')
- stylesheet('appointments', 'calendar', 'datePicker')

.span-16.append-1
  .span-15.prepend-1.last.mat
    - if current_company.schedulables_count == 0
      %h2
        == There must be at least 1 calendar
        = link_to '(add)', '' #resources_path
        == before you can view a schedule.
    - else
      .span-8
        %h3
          = label_tag "schedulable", "Schedule for", :class => 'big'
          = select_tag('schedulable', options_for_select(@schedulables.collect{ |o| [o.name, "#{o.tableize}/#{o.id}"]}, "#{@schedulable.tableize}/#{@schedulable.id}"), :class => 'text')
        %h5= link_to 'PDF Version', url_for(:format => 'pdf', :subdomain => current_subdomain)
      .span-6.prepend-1.last
        #links
          - build_calendar_when_links(@schedulable, Appointment::WHEN_WEEKS, @when, :default => Appointment::WHEN_THIS_WEEK) do |link, separator|
            = link
            = separator
          %br
          == or
          %br
          = link_to "Use a Date Range", '', :id => 'show_dates'

        #dates.hide
          = render(:partial => 'shared/date_range', :locals => {:object => Appointment.new, :url => url_for(:action => 'search', :schedulable_type => @schedulable.class.to_s.tableize, :schedulable_id => @schedulable.id, :subdomain => current_subdomain)})
      
  - unless current_company.schedulables_count == 0
    .span-15.prepend-1.last
      #appointment_flash

    .span-15.prepend-1.last
      = display_flash(:notice)
      
    .span-15.prepend-1.last
      %h2
        = @daterange.name
      .span-15.last#free_work_calendar
        = render(:partial => 'shared/calendar.html.haml', :locals => {:total_days => @daterange.days, :start_day => @daterange.start_at, :today => DateRange.today, :markings => @calendar_markings})
      %h3.span-15.last#appointments_count
        = render(:partial => 'appointments/appointments_count.html.haml', :locals => {:count => @appointments.size})
      .span-15.last#free_schedule
        = render(:partial => 'appointments/free_work_appointments', :locals => {:appointments_by_day => @appointments_by_day})
  
- unless current_company.schedulables_count == 0
  .span-6.prepend-1.last.mat
    = label_tag 'add_free_time_form', "Schedule Available Time", :class => 'big'
    - form_for(Appointment.new, :url => url_for(:subdomain => current_subdomain, :controller => 'appointments', :action => 'create'), :method => :post, :html => {:id => 'add_free_time_form'}) do |f|
      = hidden_field_tag :when, @when
      = hidden_field_tag :schedulable_type, @schedulable.tableize
      = hidden_field_tag :schedulable_id, @schedulable.id
      = hidden_field_tag :service_id, @free_service.id
      = hidden_field_tag :mark_as, Appointment::FREE
      
      .add_free_time
        .span-7.last.when
          == When
        .span-7.last
          = select_tag('dates', options_for_select(@daterange.collect { |x| [x.to_s(:appt_day), x.to_s(:appt_schedule_day)] }))
        .span-7.last#start_at_label
          == Start
        .span-7.last#start_at_text
          = text_field_tag 'start_at', '', :size => 10, :class => 'required'
          %span.example== e.g. 8:15 am
        .span-7.last#end_at_label
          == End
        .span-7.last.append-bottom#end_at_text
          = text_field_tag 'end_at', '', :size => 10, :class => 'required'
          %span.example== e.g. 5:30 pm
        .span-7.last
          #submit= f.submit 'Add', :name => nil, :class => 'button big'
          .hide#progress= image_tag 'barbershop.gif'
       
    %hr.space   
    %h4== or
    %h4= link_to "Schedule blocks of available time", url_for(:controller => 'calendar', :action => 'edit', :subdomain => current_subdomain), :class => 'rounded button'

