- title("Schedule an Apppointment")
- stylesheet('appointments', 'calendar')
- javascript('skills', 'openings')

.span-16.mat
  .span-15.prepend-1.mat
    %h2== Schedule a service
    = hidden_field_tag 'initial_schedulable_id', @schedulable.id
    - form_for(@query, :url => url_for(:controller => 'openings', :action => 'search', :subdomain => current_subdomain), :method => :post, :html => {:id => 'schedule_search_form'}) do |f|
      .span-14.last
        .span-2.text-align-right
          == What?
        .span-5.field#what
          = select_tag('service_id', options_for_select(@services.collect{ |s| [s.name, s.id]}, @service.id))
        .span-3.text-align-right
          == Who/What to schedule?
        .span-4.last.field#who
          = select_tag('schedulable_id', options_for_select(@service_schedulables.collect{ |o| [o.name, o.id]}, @schedulable.id), :style => "width: 125px; align: top;")
      %br
      .span-14.last
        .span-2.text-align-right
          == When?
        .span-5
          %span.field#when
            = select_tag('when', options_for_select(Appointment::WHEN_WEEKS, @when))
          %span.field#time
            = select_tag('time', options_for_select(Appointment::TIMES, @time))
        - if @locations.size > 1
          .span-3.text-align-right
            == Where?
          .span-4.last.field#where
            = select_tag('location_id', options_for_select(build_company_location_select_options, current_location.id), :style =>      "width: 125px;")
        - else
          .span-7.last
      .span-4.prepend-1.last
        = f.submit 'Search', :name => nil, :class => 'submit', :id => 'search_submit', :disabled => @when ? 'false' : 'true'
        %span#search_progress.hide{:style => 'padding-left: 5px;'}= image_tag 'dots.gif'

  .span-15.prepend-1.mat
    %h2== Schedule some time
    = hidden_field_tag 'initial_schedulable_id', @schedulable.id
    - form_for(@query, :url => url_for(:controller => 'openings', :action => 'search', :subdomain => current_subdomain), :method => :post, :html => {:id => 'schedule_time_search_form'}) do |f|
      .span-14.last
        .span-3.text-align-right
          == Who/What to schedule?
        .span-4.last.field#who
          = select_tag('schedulable_id', options_for_select(@company_schedulables.collect{ |o| [o.name, o.id]}, @schedulable.id), :style => "width: 125px; align: top;")
      %br
      .span-14.last
        .span-2.text-align-right
          == When?
        .span-5
          %span.field#when
            = select_tag('when', options_for_select(Appointment::WHEN_WEEKS, @when))
          %span.field#time
            = select_tag('time', options_for_select(Appointment::TIMES, @time))
      %br
      .span-14.last
        .span-2.text-align-right
          == How long?
        .span-5
          %span.field#duration-size
            = select_tag('duration_size', options_for_select(Appointment::DURATION_SIZES, @duration_size))
          %span.field#duration-units
            = select_tag('duration_units', options_for_select(Appointment::DURATION_UNITS, @duration_units))
        - if @locations.size > 1
          .span-3.text-align-right
            == Where?
          .span-4.last.field#where
            = select_tag('location_id', options_for_select(build_company_location_select_options, current_location.id), :style =>      "width: 125px;")
        - else
          .span-7.last
      .span-4.prepend-1.last
        = f.submit 'Search', :name => nil, :class => 'submit', :id => 'search_time_submit'
        %span#search_progress.hide{:style => 'padding-left: 5px;'}= image_tag 'dots.gif'



  -# skills mapping services to schedulables
  .span-16.skills.hide
    - @skills.each do |skill|
      .skill{:service_id => skill[0], :schedulable_id => skill[1], :schedulable_name => skill[2], :schedulable_type => skill[3]}

.span-7.prepend-1.last
  .sidebar.instructions.padding-5
    - if @when.blank?
      == How do I schedule an appointment?
      %ul
        %li== Select appointment criteria and click on 'Search'
    - elsif !@free_timeslots.blank?
      == What can I do here?
      %ul
        %li== Select an available appointment
        %span== or
        %li== Select different appointment criteria and search again
    - else
      == What can I do here?
      %ul
        %li== Select different appointment criteria and search again
        %span== or
        %li== Select the waitlist to be notified of an opening

.span-15.prepend-1.last
  - if !@current_company.can_schedule_appointments?
    %h2
      == Before customers can schedule appointments, there must be at least 1 calendar
      = link_to '(add)', users_path
      == and 1 service
      = link_to '(add)', services_path
      == .
