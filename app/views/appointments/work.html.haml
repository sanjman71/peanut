- title(@title)
- stylesheet('appointments', 'notes')
- javascript('appointments', 'notes')

.span-24.mat.padding-top-10.padding-bottom-10
  .span-23.prepend-1
    %h2{:style => 'margin-bottom: 5px;'}
      = @title
      %span{:style => 'margin-left: 5px; font-size: 0.5em;'}= link_to 'Back', @back, :style => 'color: #FF1100;'
      
    -# appointment state
    %h4{:style => 'margin-bottom: 5px;'}
      - if @appointment.canceled?
        == Canceled: #{@appointment.canceled_at.to_s(:appt_day_date_time)}
      - else
        == #{@appointment.state.titleize}: #{appointment_starts_at_distance_in_words(@appointment)}
    
    -# allow owners and managers to change appointment state
    - if (@owner or @manager) and @appointment.upcoming?
      %h4
        = link_to 'Mark as completed', complete_appointment_path(@appointment), :id => 'complete_appointment', :class => 'admin'
        %span#mark_progress.hide{:style => 'padding-left: 5px;'}= image_tag 'dots.gif'
        %span{:style => 'font-size: 0.7em;'}== &nbsp;|&nbsp;
        = link_to 'Cancel appointment', cancel_appointment_path(@appointment), :class => 'admin', :id => 'cancel_appointment'
        %span{:style => 'font-size: 0.7em;'}== &nbsp;|&nbsp;
        = link_to 'Re-schedule appointment', reschedule_appointment_path(@appointment), :class => 'admin', :id => 'reschedule_appointment'
            
%hr.space

.span-15.prepend-1
  = display_flash(:all)
  
.span-23.prepend-1
  = render(:partial => 'appointment', :locals => {:appointment => @appointment})
  
%hr.space

.span-23.prepend-1.text
  - # allow owners and managers to send the customer a message
  - if (@owner or @manager) and !@appointment.canceled?
    = render(:partial => 'send_message', :locals => {:appointment => @appointment})

%hr.space

.span-23.prepend-1.text
  - # allow owners and managers add invoices
  -#- if (@owner or @manager) and !@appointment.canceled?
    -#%h3== Add Invoice
    
.span-15.prepend-1  
  -# notes flash message
  #note_flash

  -# add note
  .new_note#new_note_container
    %p
    %h4== Add a note about this appointment
    = render(:partial => 'notes/add_note.html.haml', :locals => {:note => @note, :subject => @appointment, :subdomain => current_subdomain})
  %p
  -# appointment notes
  #notes_collection
    = render(:partial => 'notes/notes.html.haml', :locals => {:notes => @notes})




